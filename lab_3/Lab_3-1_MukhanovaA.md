# Лабораторная работа №3.1 (Вар.9)
## Проектирование архитектуры хранилища больших данных

### Сведения
- **Дисциплина:** Инструменты для хранения и обработки больших данных
- **Направление подготовки:** 38.03.05 – «бизнес-информатика»
- **Студент:** Муханова А. И., группа АДЭУ-221
- **Преподаватель:** Босенко Т. М., к.т.н., доц. департамента информатики, управления и технологий

---

## 1. Цель работы

**Сценарий:** образовательная онлайн-платформа, предназначенная для персонализации траекторий обучения, анализа успеваемости студентов, рекомендации курсов и проведения А/В-тестирования новых функций.

**Источники данных:**
- Логи взаимодействия с платформой (clickstream)
- Результаты тестов
- Видеолекции
- Метаданные курсов и профили пользователей

**Типы данных:**
- **Структурированные** — профили пользователей, результаты тестов, оценки, расписания
- **Полуструктурированные** — логи взаимодействия (JSON), события кликов, события воспроизведения видео
- **Неструктурированные** — видеолекции, текстовые отзывы, загруженные файлы

**Объёмы и скорость:**
- До 1–3 ТБ данных в год
- Потоковая генерация событий: 1 000–5 000 сообщений/сек
- Пакетные загрузки: результаты тестов, выгрузки LMS

**Бизнес-цели:**
- Персонализация обучения в near-real-time
- Мониторинг успеваемости
- А/В-тестирование интерфейсов и рекомендаций
- Отчётность для преподавателей и администраторов

**Требования к задержке/доступности:**
- Персональные рекомендации: задержка < 2 секунд
- Отчёты и модельное обучение: пакетная обработка с периодичностью от часов до дней

**Требования к безопасности:**
- VK Cloud IAM: разграничение ролей
- Шифрование данных в S3-хранилище

---

## 2. Выбор компонентов архитектуры

**Модель:** Data Lakehouse — объединение гибкости Data Lake и управляемости DW.

| Слой | Реализация |
|------|------------|
| **Источники данных** | Логи взаимодействия (веб/мобильные приложения), Результаты тестов (СУБД платформы), Видеолекции (файлы), Метаданные курсов и пользователей |
| **Хранение данных** | VK Cloud S3 (Data Lake, Delta Lake/Iceberg), ClickHouse (DWH Аналитика), PostgreSQL (OLTP, ML features via pgvector) |
| **Обработка данных** | Apache Flink (Потоковая обработка), Apache Spark (Пакетная обработка) |
| **Аналитика** | Apache Superset (BI дашборды), Grafana (Real-time мониторинг) |
| **Обслуживание** | Kubernetes VK Cloud (Управление ML) |
| **Оркестрация и Мониторинг** | Apache Airflow, Grafana |
| **Безопасность и Управление** | Apache Ranger |

---

## 3. Обоснование выбора

| Компонент | Почему выбран |
|-----------|---------------|
| **VK Cloud S3 + Delta Lake/Iceberg** | Российское облачное хранилище с поддержкой транзакционных форматов для надежного Data Lake |
| **ClickHouse** | Российская высокопроизводительная СУБД для аналитических запросов по успеваемости и активности |
| **PostgreSQL + pgvector** | Надежная OLTP-БД с векторными операциями для ML-рекомендаций и хранения фич |
| **Apache Flink** | Обработка потоковых данных логов взаимодействия в реальном времени для персонализации |
| **Apache Spark** | Пакетная обработка для ETL-пайплайнов, расчета метрик успеваемости, подготовки данных для ML |
| **Apache Superset** | Открытая BI-платформа для создания дашбордов для преподавателей и администраторов |
| **Grafana** | Мониторинг активности платформы в реальном времени и метрик производительности |
| **Kubernetes VK Cloud** | Российская облачная платформа для оркестрации ML-сервисов рекомендаций |
| **Apache Airflow** | Оркестрация всех данных пайплайнов и ML-процессов |
| **Apache Ranger** | Централизованное управление безопасностью и доступом к данным платформы |

## 4. Диаграмма архитектуры
<img width="712" height="1051" alt="lab_3-1 (1)-lab3-1_architecture drawio" src="https://github.com/user-attachments/assets/b5927810-e01f-4d62-aca9-4f7ef22dabf8" />

---

## 5. Описание потоков данных

**Пример 1 — Логи взаимодействия → Персонализация обучения:**
1. Веб/мобильное приложение отправляет события взаимодействия → Apache Kafka
2. Apache Flink обрабатывает события в реальном времени → вычисляет активность студентов → результаты публикует в ClickHouse и обновляет векторы в PostgreSQL
3. Apache Spark ежедневно обрабатывает накопленные логи из VK Cloud S3 → строит витрины успеваемости → обновляет ClickHouse

**Пример 2 — Результаты тестов → Аналитика успеваемости:**
1. СУБД платформы отправляет результаты тестов через Debezium → VK Cloud S3 (Raw Zone)
2. Apache Spark обрабатывает данные → рассчитывает средний балл, прогресс по курсам → записывает результаты в ClickHouse и PostgreSQL

**Пример 3 — Видеолекции → Аналитика вовлеченности:**
1. Видеофайлы загружаются через Apache NiFi → VK Cloud S3
2. Метрики просмотра отправляются → Apache Kafka → Apache Flink → агрегируются в ClickHouse

---

## 6. Отказоустойчивость и масштабируемость

- **VK Cloud S3** — автоматическая репликация данных, неограниченное масштабирование хранилища
- **ClickHouse** — кластерная конфигурация с репликацией данных для отказоустойчивости аналитических запросов
- **PostgreSQL** — репликация и резервное копирование для обеспечения доступности ML-сервисов
- **Apache Flink** — checkpointing для восстановления состояния потоковой обработки
- **Apache Spark** — snapshot и восстановление состояний пакетной обработки
- **Kubernetes VK Cloud** — автоматическое масштабирование ML-сервисов в зависимости от нагрузки

---

## 7. Потенциальные проблемы и решения

**1) Рост стоимости хранения образовательного контента:**
- *Решение:* Внедрение политик жизненного цикла в VK Cloud S3 → автоматическое перемещение старых видео в холодное хранилище

**2) Обеспечение конфиденциальности образовательных данных:**
- *Решение:* Шифрование данных в хранилищах, управление доступом через Apache Ranger, минимизация хранения персональных данных, псевдонимизация в аналитических витринах

**3) Интеграция потоковых и пакетных данных для единой аналитики:**
- *Решение:* Использование формата Delta Lake/Iceberg в VK Cloud S3 как единого слоя для согласованного доступа к данным

---

## 8. Выводы

Предложенная архитектура обеспечивает эффективное управление образовательными данными и реализацию персонализированного подхода к обучению. Использование связки **Apache Kafka + Apache Flink** позволяет обрабатывать активность студентов в реальном времени для мгновенной адаптации учебного процесса. **Data Lake на базе VK Cloud S3** с поддержкой Delta Lake гарантирует надежное хранение разнородных образовательных данных. **ClickHouse** обеспечивает высокоскоростную аналитику успеваемости, а **PostgreSQL с pgvector** — реализацию интеллектуальных систем рекомендаций. Архитектура масштабируема, отказоустойчива и соответствует требованиям современных образовательных платформ.



## PS: 9. Примерная стоимость реализации и окупаемость 

**Годовые затраты на инфраструктуру для 100 студентов:**

| Компонент | Примерная стоимость |
|-----------|---------------------|
| VK Cloud S3 (1 ТБ) | 24,000 руб./год |
| ClickHouse (1 нода) | 96,000 руб./год |
| PostgreSQL (1 нода) | 60,000 руб./год |
| Kubernetes кластер | 96,000 руб./год |
| Виртуальные машины (3 ноды) | 180,000 руб./год |
| **Итого инфраструктура** | **~456,000 руб./год** |

**Штат команды (минимальный):**
- Data Engineer (0.5 ставки): ~720,000 руб./год
- DevOps (0.25 ставки): ~450,000 руб./год  
- ML-инженер (0.2 ставки): ~360,000 руб./год
- **Итого персонал:** **~1,530,000 руб./год**

**Дополнительные расходы:**
- Лицензии ПО: ~120,000 руб./год
- Резервные копии: ~36,000 руб./год
- **Итого дополнительные:** **~156,000 руб./год**

**СУММАРНЫЕ ЗАТРАТЫ В ГОД:** ~2,142,000 руб./год

**Расчет стоимости курса для окупаемости:**

| Сценарий | Стоимость курса | Примечания |
|----------|-----------------|------------|
| **Базовый** | 2,800 руб./мес | Только окупаемость инфраструктуры |
| **Стандартный** | 4,500 руб./мес | Окупаемость + 15% рентабельности |
| **Премиум** | 7,500 руб./мес | Полная окупаемость с запасом |
| **Корпоративный** | 3,500 руб./мес | 10+ сотрудников |

**Оптимальная стратегия ценообразования:**
- **3,200-4,800 руб./мес** за курс
- При 100 студентах: **3,000,000 руб./год** выручки
- Рентабельность: **~30-40%**
